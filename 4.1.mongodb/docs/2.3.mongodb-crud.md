# **ğŸ› ï¸ MongoDB CRUD Operations â€“ Insert, Update, Delete & Best Practices ğŸš€**

CRUD (Create, Read, Update, Delete) operations are the foundation of working with MongoDB. While **querying** focuses on retrieving data efficiently, **CRUD operations** ensure data is modified and maintained correctly.

---

## **ğŸ“ 1ï¸âƒ£ Inserting Documents in MongoDB**

### **ğŸ“Œ `InsertOne()` â€“ Insert a Single Document**

```bash
db.users.insertOne({
  "name": "Ahmed",
  "email": "ahmed@example.com",
  "age": 30,
  "status": "active"
})
```

âœ”ï¸ **Generates an `_id` field automatically if not provided.**  
âœ”ï¸ **Returns an acknowledgment with the inserted ID.**

---

### **ğŸ“Œ `InsertMany()` â€“ Insert Multiple Documents**

```bash
db.users.insertMany([
  { "name": "Ali", "email": "ali@example.com", "age": 25 },
  { "name": "Sara", "email": "sara@example.com", "age": 28 }
])
```

âœ”ï¸ **Inserts multiple documents in one operation.**  
âœ”ï¸ **Faster than calling `insertOne()` multiple times.**

---

## **ğŸ”„ 2ï¸âƒ£ Updating Documents in MongoDB**

MongoDB provides **multiple ways to update documents**:  
âœ”ï¸ **Update specific fields (`$set`)**  
âœ”ï¸ **Increment values (`$inc`)**  
âœ”ï¸ **Modify arrays (`$push`, `$pull`, `$addToSet`)**

---

### **ğŸ“Œ `UpdateOne()` â€“ Update a Single Document**

```bash
db.users.updateOne(
  { "email": "ahmed@example.com" },
  { "$set": { "status": "inactive" } }
)
```

âœ”ï¸ **Updates the first matching document only.**  
âœ”ï¸ **Only updates specified fields (doesnâ€™t overwrite the entire document).**

---

### **ğŸ“Œ `UpdateMany()` â€“ Update Multiple Documents**

```bash
db.users.updateMany(
  { "status": "active" },
  { "$set": { "status": "inactive" } }
)
```

âœ”ï¸ **Updates all matching documents.**  
âœ”ï¸ **Efficient for bulk updates.**

---

### **ğŸ“Œ `$inc` â€“ Increment Numeric Fields**

ğŸ’¡ **Increase the `age` field by 1 for a user.**

```bash
db.users.updateOne(
  { "email": "ahmed@example.com" },
  { "$inc": { "age": 1 } }
)
```

âœ”ï¸ **Useful for counters, stock management, etc.**

---

### **ğŸ“Œ `$push`, `$pull`, `$addToSet` â€“ Updating Arrays**

ğŸ’¡ **Add a new tag to a userâ€™s `tags` array.**

```bash
db.users.updateOne(
  { "email": "ahmed@example.com" },
  { "$push": { "tags": "mongodb" } }
)
```

ğŸ’¡ **Remove `"mongodb"` from the `tags` array.**

```bash
db.users.updateOne(
  { "email": "ahmed@example.com" },
  { "$pull": { "tags": "mongodb" } }
)
```

ğŸ’¡ **Ensure `"mongodb"` is added only once.**

```bash
db.users.updateOne(
  { "email": "ahmed@example.com" },
  { "$addToSet": { "tags": "mongodb" } }
)
```

âœ”ï¸ **Useful for managing array fields efficiently.**

---

## **âŒ 3ï¸âƒ£ Deleting Documents in MongoDB**

### **ğŸ“Œ `DeleteOne()` â€“ Delete a Single Document**

```bash
db.users.deleteOne({ "email": "ahmed@example.com" })
```

âœ”ï¸ **Deletes the first matching document only.**  
âœ”ï¸ **Useful for deleting a single user or record.**

---

### **ğŸ“Œ `DeleteMany()` â€“ Delete Multiple Documents**

```bash
db.users.deleteMany({ "status": "inactive" })
```

âœ”ï¸ **Deletes all matching documents.**  
âœ”ï¸ **Use with caution to avoid accidental data loss!**

---

## **âœ… 4ï¸âƒ£ Atomic Operations & Best Practices for Safe Updates**

### **ğŸ“Œ Use `findOneAndUpdate()` to Get the Updated Document**

ğŸ’¡ **Return the updated user document after increasing age by 1.**

```bash
db.users.findOneAndUpdate(
  { "email": "ahmed@example.com" },
  { "$inc": { "age": 1 } },
  { returnDocument: "after" }
)
```

âœ”ï¸ **Returns the updated document directly.**

---

### **ğŸ“Œ Use Transactions for Multi-Step Operations**

ğŸ’¡ **If modifying multiple collections, wrap updates in a transaction.**

```javascript
const session = db.getMongo().startSession();
session.startTransaction();
try {
  db.orders.updateOne({ _id: 123 }, { $set: { status: "shipped" } });
  db.inventory.updateOne({ productId: 456 }, { $inc: { stock: -1 } });
  session.commitTransaction();
} catch (error) {
  session.abortTransaction();
}
session.endSession();
```

âœ”ï¸ **Ensures consistency across multiple updates.**

---

## **ğŸ¯ 5ï¸âƒ£ Sequence Diagram â€“ MongoDB CRUD Workflow**

```mermaid
sequenceDiagram
    participant User as User
    participant QueryEngine as MongoDB Query Engine
    participant WiredTiger as WiredTiger Storage Engine
    participant Disk as Disk Storage

    User->>QueryEngine: Insert / Update / Delete Request
    QueryEngine->>WiredTiger: Process Write Operation
    WiredTiger->>Disk: Append Changes to Journal (WAL)
    Disk-->>WiredTiger: Confirm Write Persisted
    WiredTiger-->>QueryEngine: Return Write Acknowledgment
    QueryEngine-->>User: Operation Successful
```

ğŸ’¡ **Key Takeaways from the Sequence Diagram:**  
âœ”ï¸ **Writes go through WiredTiger before being committed to disk.**  
âœ”ï¸ **MongoDB uses journaling for durability.**  
âœ”ï¸ **All CRUD operations return an acknowledgment.**

---

## **ğŸ† 6ï¸âƒ£ Summary â€“ MongoDB CRUD Best Practices**

âœ”ï¸ **Use `insertOne()` & `insertMany()` for inserting documents efficiently.**  
âœ”ï¸ **Use `updateOne()`, `updateMany()`, and atomic operators (`$set`, `$inc`, `$push`) for updates.**  
âœ”ï¸ **Use `deleteOne()` and `deleteMany()` cautiously to avoid accidental deletions.**  
âœ”ï¸ **Use transactions for multi-step operations that need consistency.**  
âœ”ï¸ **Use `findOneAndUpdate()` to get updated documents immediately.**

---

Now that weâ€™ve covered **CRUD operations**, we can move to **MongoDB Aggregation & Advanced Data Processing**.

ğŸ›  **Next Topics:**  
âœ”ï¸ **MongoDB Aggregation Framework â€“ Grouping, Filtering & Data Transformation**  
âœ”ï¸ **Working with Geospatial Data & Text Search in MongoDB**

ğŸ’¡ **Let me know if you want to continue! ğŸš€ğŸ”¥**
