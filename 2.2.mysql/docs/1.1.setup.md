# Setup Mysql

## Installation

### Setup on VM

#### Linux

```bash
# Install MySQL from root user
apt update && apt full-upgrade -y
apt install mysql-server -y
service mysql start # or  'systemctl start mysql' if systemd is installed
```

#### Windows

```pwsh

```

### Setup on Containers

#### Install on ubuntu container

```bash
####
docker run --rm -it -v $(pwd)/databases:/usr/databases ubuntu:latest bash

# Install MySQL from root user
apt update && apt full-upgrade -y
apt install mysql-server -y
service mysql start # or  'systemctl start mysql' if systemd is installed

# Connect to mysql interactive shell
mysql


####
# cleanup
sudo apt remove mysql-server -y
sudo apt autoremove -y
```

#### Install on mysql-server container

```yaml
version: "3.7"

services:
  mysql-db:
    image: mysql:8.0.40-debian
    container_name: mysql-db
    hostname: mysql-db
    command: --default-authentication-plugin=mysql_native_password
    restart: always
    volumes:
      - ./databases:/usr/databases
    ports:
      - 3306:3306
      - 33060:33060
    environment:
      MYSQL_ROOT_PASSWORD: "P@ssw0rd"

  mysql-workbench:
    image: linuxserver/mysql-workbench:latest
    container_name: mysql-workbench
    hostname: mysql-workbench
    environment:
      - PUID=1000
      - PGID=1000
    volumes:
      - ./databases:/usr/databases
    ports:
      - 3000:3000
    cap_add:
      - IPC_LOCK
    restart: unless-stopped

  jupyter:
    image: asami76/allspark:latest
    container_name: jupyter
    hostname: jupyter
    environment:
      - PUID=1000
      - PGID=1000
    volumes:
      - ./databases:/home/jovyan/
    ports:
      - 8888:8888
    restart: unless-stopped
```

```bash
# Use Docker
docker run -d -v /var/run/docker.sock:/tmp/docker.sock -v /etc/hosts:/tmp/hosts asami76/docker-hoster

docker-compose -f mysql.yml up -d
```

```bash

```

## Post Installation Tasks

### 1. Secure the MySQL Server (Only for VM Method)

> ðŸ“’ Note: This step is necessary only if you set up MySQL on a VM and not using the official MySQL Docker image, as the official image already includes this configuration and sets up the authentication method.

```bash
# Connect to mysql interactive shell
mysql

# To allow remote connections from root user to mysql server
ALTER USER 'root'@'localhost' IDENTIFIED WITH mysql_native_password by 'P@ssw0rd';

# Disconnect from mysql interactive shell
exit


# Re-connect to mysql interactive shell with admin user
mysql -u root -pP@ssw0rd # -p[Password] without spaces
```

### 2. Check Installation

```bash
# to list the current databases
SHOW DATABASES;

# to check the folder where the databases are stored
SHOW VARIABLES WHERE Variable_name = 'datadir';

# to create a database called testdb
CREATE DATABASE test-db;

# to create a table called tbl1
USE test-db;
CREATE TABLE tbl1 (id INT, name VARCHAR(20));
exit

# Check the file structure after creating the database and the table
cd /var/lib/mysql
ls -l test-db
```

### 3. Restore Databases

```bash
# To restore a database called 'sakila' from a dump file
# Download the dump file from https://dev.mysql.com/doc/index-other.html
# make sure to download the schema and data files
# make sure to change the path to the dump file
SOURCE /usr/databases/sakila-db/sakila-schema.sql;
USE sakila;
SOURCE /usr/databases/sakila-db/sakila-data.sql;
SHOW TABLES FROM sakila;
SELECT * FROM actor LIMIT 10;
DESCRIBE actor;
SHOW COLUMNS FROM actor;
SHOW CREATE TABLE actor\G # \G for better format
```
